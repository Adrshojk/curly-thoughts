import React, { useEffect, Fragment } from 'react'
import Feed from 'components/feed'
import useFetch from 'hooks/useFetch'
import Pagination from 'components/pagination'
import {getPaginator,limit} from 'utils'
import { stringify } from 'query-string'
import PopularTags from 'components/popularTags'
import Loading from 'components/loading'
import FeedToggler from 'components/feedToggler'

const TagFeed= ({location,match}) => {
    const tagName=match.params.slug
    const {offset,currentPage}=getPaginator(location.search)
    const stringifiedParameter=stringify({
        limit,offset,tag:tagName
    })
    const apiUrl=`/articles?${stringifiedParameter}`
    const currentUrl=match.url
    const [{response,error,isLoading},doFetch]=useFetch(apiUrl)
    
    useEffect(()=>{
        doFetch()
    },[doFetch,currentPage])
    return (
        <div className="home-page">
            <div className="banner">
                <h1>Curly Thoughts</h1>
                <p>A place to share thoughts</p>
            </div>
            <div className="container page">
                <div className="row">
                    <div className="col-md-9">
                        <FeedToggler tagName={tagName}/>
                        {isLoading&&<Loading/>}
                        {error&& <div>Some Error happened</div> }
                        {!isLoading && response && (
                            <Fragment>
                             <Feed articles={response.articles} />
                             <Pagination total={response.articlesCount} limit={limit} url={currentUrl} currentPage={currentPage} />
                            </Fragment>
                        )}
                    </div>
                    <div className="col-md-3">
                    <PopularTags/>
                    </div>
                </div>
            </div>
            
        </div>
    )
}

export default TagFeed