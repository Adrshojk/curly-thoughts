import useFetch from 'hooks/useFetch'
import {useEffect} from 'react'
import {CurrentUserContext} from 'context/currentUser'
import { useContext } from 'react'
import useLocalSorage from 'hooks/useLocalStorage'

const CurrentUserChecker=({children})=>{
    const[,setCurrentUserState]=useContext(CurrentUserContext)
    const[{response},doFetch]=useFetch('/user')
    console.log('response',response);
    const[token]=useLocalSorage('token')
    useEffect(() => {
        if(!token){
            setCurrentUserState(state=>({
                ...state,
               isLoggedIn:false,
                }))
            return
        }
        doFetch()
        setCurrentUserState(state=>({
            ...state,
            isLoading:true,
        }))
    }, [])

    useEffect(()=>{
        if(!response){
            return
        }
        setCurrentUserState(state=>({
            ...state,
            isLoading:false,
            isLoggedIn:true,
            currentUser:response.user
        }))
    },[response])

return children
}
export default CurrentUserChecker